@model Training

@{
    ViewData["Title"] = "Add New Training";
    Layout = "_ModernAdminLayout";
}

<div style="padding: 0 32px 32px 32px;">
    <div style="margin-bottom: 32px;">
        <h1 style="font-size: 32px; font-weight: 700; color: var(--text-primary); margin-bottom: 8px;">
            <i class="fas fa-plus-circle" style="color: var(--primary); margin-right: 12px;"></i>Add New Training
        </h1>
    </div>

    <div class="modern-card">
        <form asp-area="Admin" asp-controller="Trainings" asp-action="Create" method="post" class="needs-validation" novalidate>
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="Title" class="form-label">Training Title <span style="color: var(--error);">*</span></label>
                        <input asp-for="Title" class="form-control" placeholder="e.g., Azure Fundamentals for Developers" required />
                        <span asp-validation-for="Title" style="color: var(--error);"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="Company" class="form-label">Company/Client Name <span style="color: var(--error);">*</span></label>
                        <input asp-for="Company" class="form-control" placeholder="e.g., ABC Corp" required />
                        <span asp-validation-for="Company" style="color: var(--error);"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="mb-3">
                        <label asp-for="Description" class="form-label">
                            Training Description <span style="color: var(--error);">*</span>
                            <span id="wordCount" style="color: var(--text-muted); font-weight: normal; float: right; font-size: 13px;">0/1000 words</span>
                        </label>
                        <textarea asp-for="Description" class="form-control" rows="4" placeholder="Detailed description of the training" required maxlength="2000" id="descriptionField"></textarea>
                        <span asp-validation-for="Description" style="color: var(--error);"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="DeliveryDate" class="form-label">Delivery Date</label>
                        <input asp-for="DeliveryDate" type="datetime-local" class="form-control" />
                        <small class="form-text" style="color: var(--text-muted);">Optional: When the training will be delivered</small>
                        <span asp-validation-for="DeliveryDate" style="color: var(--error);"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="Duration" class="form-label">Duration</label>
                        <input asp-for="Duration" class="form-control" placeholder="e.g., 2 days, 8 hours, 1 week" />
                        <small class="form-text" style="color: var(--text-muted);">Optional: Duration of the training program</small>
                        <span asp-validation-for="Duration" style="color: var(--error);"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="mb-3">
                        <label asp-for="Topics" class="form-label">Topics Covered <span style="color: var(--error);">*</span></label>
                        <input asp-for="Topics" class="form-control" placeholder="e.g., Azure, Cloud Architecture, DevOps" required />
                        <small class="form-text" style="color: var(--text-muted);">Comma-separated list of topics</small>
                        <span asp-validation-for="Topics" style="color: var(--error);"></span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="ImageUrl" class="form-label">Training Image</label>
                        <div class="thumbnail-input-group">
                            <input asp-for="ImageUrl" class="form-control mb-2" id="thumbnailUrl" placeholder="Enter URL or upload image" />
                            <div class="d-flex gap-2 align-items-center mb-2">
                                <input type="file" class="form-control" id="thumbnailFile" accept="image/*" style="flex: 1;" />
                                <button type="button" class="btn btn-sm btn-secondary" onclick="document.getElementById('thumbnailFile').value = ''; document.getElementById('thumbnailPreview').src = ''; document.getElementById('thumbnailPreview').style.display = 'none';">Clear</button>
                            </div>
                            <img id="thumbnailPreview" src="" alt="Preview" style="display: none; max-width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-top: 8px;" />
                        </div>
                        <small class="form-text" style="color: var(--text-muted);">Upload image or enter URL. Recommended: 800x450px</small>
                        <span asp-validation-for="ImageUrl" style="color: var(--error);"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label asp-for="SkillTechUrl" class="form-label">Training Link (SkillTech URL)</label>
                        <input asp-for="SkillTechUrl" class="form-control" placeholder="https://skilltech.club/trainings/..." />
                        <small class="form-text" style="color: var(--text-muted);">When users click the training card, they will be redirected to this URL (Optional)</small>
                        <span asp-validation-for="SkillTechUrl" style="color: var(--error);"></span>
                    </div>
                </div>
            </div>

            <div style="margin-top: 32px; display: flex; gap: 12px;">
                <button type="submit" class="modern-btn modern-btn-primary">
                    <i class="fas fa-save"></i> Add Training
                </button>
                <a asp-area="Admin" asp-controller="Trainings" asp-action="Index" class="modern-btn modern-btn-ghost">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        // Word counter for description
        const descField = document.getElementById('descriptionField');
        const wordCount = document.getElementById('wordCount');
        
        descField.addEventListener('input', function() {
            const text = this.value.trim();
            const words = text.length > 0 ? text.split(/\s+/).length : 0;
            wordCount.textContent = words + '/1000 words';
            
            if (words > 1000) {
                wordCount.style.color = 'var(--error)';
            } else if (words > 900) {
                wordCount.style.color = 'var(--warning)';
            } else {
                wordCount.style.color = 'var(--text-muted)';
            }
        });
    </script>

    <script>
        // Thumbnail file upload handler
        document.getElementById('thumbnailFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const preview = document.getElementById('thumbnailPreview');
                    preview.src = event.target.result;
                    preview.style.display = 'block';
                    document.getElementById('thumbnailUrl').value = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Show preview if URL is entered
        document.getElementById('thumbnailUrl').addEventListener('input', function() {
            const url = this.value;
            if (url && (url.startsWith('http') || url.startsWith('data:'))) {
                const preview = document.getElementById('thumbnailPreview');
                preview.src = url;
                preview.style.display = 'block';
            }
        });
    </script>
}
