@model MarutiTrainingPortal.Models.ViewModels.AdminDashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Areas/Admin/Views/Shared/_ModernAdminLayout.cshtml";
}

<div style="padding: 24px 48px 48px 48px;">
    <!-- Modern Page Header -->
    <div style="margin-bottom: 32px;">
        <h1 style="font-size: 36px; font-weight: 700; color: var(--text-primary); margin-bottom: 12px;">
            <i class="fas fa-chart-line" style="color: #7c3aed; margin-right: 12px;"></i>Dashboard Overview
        </h1>
        <p style="color: var(--text-secondary); font-size: 16px; margin: 0;">Welcome back! Here's what's happening with your training portal.</p>
    </div>

    <!-- Modern Stat Cards Grid -->
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-bottom: 40px;">
        <!-- Trainings Stat Card -->
        <div class="stat-card">
            <div class="stat-card-icon blue">
                <i class="fas fa-chalkboard-teacher"></i>
            </div>
            <div class="stat-card-content">
                <div class="stat-card-label">Total Trainings</div>
                <div class="stat-card-value">@Model.TotalTrainings</div>
                <a asp-area="Admin" asp-controller="Trainings" asp-action="Index" style="display: inline-flex; align-items: center; gap: 8px; color: #7c3aed; font-size: 14px; font-weight: 600; text-decoration: none; margin-top: 12px; padding: 8px 12px; background: rgba(124, 58, 237, 0.1); border-radius: 6px; transition: all 0.2s; position: relative; z-index: 10;">
                    Manage Trainings <i class="fas fa-arrow-right" style="font-size: 12px;"></i>
                </a>
            </div>
        </div>

        <!-- Courses Stat Card -->
        <div class="stat-card">
            <div class="stat-card-icon green">
                <i class="fas fa-video"></i>
            </div>
            <div class="stat-card-content">
                <div class="stat-card-label">Total Courses</div>
                <div class="stat-card-value">@Model.TotalCourses</div>
                <a asp-area="Admin" asp-controller="Courses" asp-action="Index" style="display: inline-flex; align-items: center; gap: 8px; color: #059669; font-size: 14px; font-weight: 600; text-decoration: none; margin-top: 12px; padding: 8px 12px; background: rgba(5, 150, 105, 0.1); border-radius: 6px; transition: all 0.2s; position: relative; z-index: 10;">
                    Manage Courses <i class="fas fa-arrow-right" style="font-size: 12px;"></i>
                </a>
            </div>
        </div>

        <!-- Events Stat Card -->
        <div class="stat-card">
            <div class="stat-card-icon purple">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="stat-card-content">
                <div class="stat-card-label">Total Events</div>
                <div class="stat-card-value">@Model.TotalEvents</div>
                <a asp-area="Admin" asp-controller="Events" asp-action="Index" style="display: inline-flex; align-items: center; gap: 8px; color: #7c3aed; font-size: 14px; font-weight: 600; text-decoration: none; margin-top: 12px; padding: 8px 12px; background: rgba(124, 58, 237, 0.1); border-radius: 6px; transition: all 0.2s; position: relative; z-index: 10;">
                    Manage Events <i class="fas fa-arrow-right" style="font-size: 12px;"></i>
                </a>
            </div>
        </div>

    </div>

    <!-- Charts Section - Side by Side Layout -->
    <div style="display: grid; grid-template-columns: 2.5fr 1.5fr; gap: 24px; margin-bottom: 40px;">
        <!-- Monthly Training Statistics - Takes 2.5 parts -->
        <div class="modern-card">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600; color: var(--text-primary); margin: 0;">
                    <i class="fas fa-chart-line" style="color: #7c3aed; margin-right: 10px;"></i>Monthly Training Statistics
                </h3>
                <div class="modern-badge">Last 6 Months</div>
            </div>
            <div style="position: relative; height: 320px;">
                <canvas id="monthlyTrainingsChart"></canvas>
            </div>
        </div>

        <!-- Courses by Category - Takes 1.5 parts -->
        <div class="modern-card">
            <div style="margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600; color: var(--text-primary); margin: 0;">
                    <i class="fas fa-chart-pie" style="color: #2563eb; margin-right: 10px;"></i>Courses by Category
                </h3>
            </div>
            <div style="position: relative; height: 320px; display: flex; align-items: center; justify-content: center;">
                <canvas id="coursesByCategoryChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Modern Activity Cards -->
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px;">
        <!-- Recent Contact Messages -->
        <div class="modern-card">
            <div style="margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600; color: var(--text-primary); margin: 0;">
                    <i class="fas fa-comments" style="color: #ea580c; margin-right: 10px;"></i>Recent Contact Messages
                </h3>
            </div>
            @if (Model.RecentMessages.Any())
            {
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    @foreach (var msg in Model.RecentMessages)
                    {
                        <div style="padding: 16px; border: 1px solid var(--border-light); border-radius: 8px; transition: all 0.2s ease;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                <h4 style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin: 0;">@msg.Subject</h4>
                                <span class="modern-badge">@msg.CreatedDate.ToString("MMM dd")</span>
                            </div>
                            <p style="font-size: 14px; color: var(--text-primary); margin-bottom: 8px;">
                                <i class="fas fa-user" style="color: var(--text-secondary); font-size: 12px; margin-right: 6px;"></i>
                                <strong>@msg.Name</strong> <span style="color: var(--text-secondary);">(@msg.Email)</span>
                            </p>
                            <p style="font-size: 13px; color: var(--text-secondary); line-height: 1.6; margin: 0;">
                                @(msg.Message.Length > 100 ? msg.Message.Substring(0, 100) + "..." : msg.Message)
                            </p>
                        </div>
                    }
                </div>
            }
            else
            {
                <div style="text-align: center; padding: 48px 24px; color: var(--text-secondary);">
                    <i class="fas fa-inbox" style="font-size: 48px; color: var(--border-light); margin-bottom: 16px; display: block;"></i>
                    <p style="margin: 0; font-size: 14px;">No messages yet.</p>
                </div>
            }
        </div>

        <!-- Upcoming Events -->
        <div class="modern-card">
            <div style="margin-bottom: 24px;">
                <h3 style="font-size: 20px; font-weight: 600; color: var(--text-primary); margin: 0;">
                    <i class="fas fa-calendar-check" style="color: #7c3aed; margin-right: 10px;"></i>Upcoming Events
                </h3>
            </div>
            @if (Model.UpcomingEventsList.Any())
            {
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    @foreach (var evt in Model.UpcomingEventsList)
                    {
                        <div style="padding: 16px; border: 1px solid var(--border-light); border-radius: 8px; transition: all 0.2s ease;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                <h4 style="font-size: 15px; font-weight: 600; color: var(--text-primary); margin: 0;">@evt.Title</h4>
                                <span class="modern-badge">@evt.StartDate.ToString("MMM dd")</span>
                            </div>
                            <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">
                                <i class="fas fa-map-marker-alt" style="font-size: 12px; margin-right: 6px;"></i>@evt.Location
                            </p>
                            <p style="font-size: 13px; color: var(--text-secondary); line-height: 1.6; margin: 0;">@evt.Description</p>
                        </div>
                    }
                </div>
            }
            else
            {
                <div style="text-align: center; padding: 48px 24px; color: var(--text-secondary);">
                    <i class="fas fa-calendar-times" style="font-size: 48px; color: var(--border-light); margin-bottom: 16px; display: block;"></i>
                    <p style="margin: 0; font-size: 14px;">No upcoming events.</p>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        // Modern Chart Configuration
        Chart.defaults.font.family = "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif";
        Chart.defaults.color = '#6b7280';
        
        // Fetch chart data from protected endpoint
        fetch('@Url.Action("GetChartData", "Dashboard", new { area = "Admin" })')
            .then(response => response.json())
            .then(data => {
                // Monthly Trainings Line Chart - Modern Purple-Blue Gradient
                const monthlyCtx = document.getElementById('monthlyTrainingsChart').getContext('2d');
                const gradientFill = monthlyCtx.createLinearGradient(0, 0, 0, 300);
                gradientFill.addColorStop(0, 'rgba(124, 58, 237, 0.1)');
                gradientFill.addColorStop(1, 'rgba(37, 99, 235, 0.02)');
                
                new Chart(monthlyCtx, {
                    type: 'line',
                    data: {
                        labels: data.monthlyTrainings.labels,
                        datasets: [{
                            label: 'Trainings per Month',
                            data: data.monthlyTrainings.data,
                            backgroundColor: gradientFill,
                            borderColor: '#7c3aed',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#ffffff',
                            pointBorderColor: '#7c3aed',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                display: false
                            }
                        },
                        scales: { 
                            y: { 
                                beginAtZero: true, 
                                ticks: { stepSize: 1 },
                                grid: {
                                    color: '#e4e4e7',
                                    drawBorder: false
                                },
                                border: { display: false }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                border: { display: false }
                            }
                        }
                    }
                });

                // Courses by Category Doughnut Chart - Modern Pastel Colors
                const categoryCtx = document.getElementById('coursesByCategoryChart').getContext('2d');
                new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: data.coursesByCategory.labels,
                        datasets: [{
                            data: data.coursesByCategory.data,
                            backgroundColor: [
                                '#dbeafe',
                                '#ede9fe',
                                '#fed7aa',
                                '#d1fae5',
                                '#fce7f3',
                                '#fef3c7'
                            ],
                            borderColor: [
                                '#3b82f6',
                                '#7c3aed',
                                '#ea580c',
                                '#059669',
                                '#ec4899',
                                '#eab308'
                            ],
                            borderWidth: 2,
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'bottom',
                                labels: {
                                    padding: 16,
                                    font: {
                                        size: 13
                                    },
                                    usePointStyle: true,
                                    pointStyle: 'circle'
                                }
                            }
                        },
                        cutout: '65%'
                    }
                });
            })
            .catch(error => console.error('Error loading chart data:', error));
    </script>
}

@section Styles {
    <style>
        /* Responsive grid for stat cards */
        @@media (max-width: 1200px) {
            div[style*="grid-template-columns: repeat(4, 1fr)"] {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }
        
        @@media (max-width: 768px) {
            div[style*="grid-template-columns: repeat(4, 1fr)"] {
                grid-template-columns: 1fr !important;
            }
            
            .bento-grid > div[style*="grid-column: span 2"] {
                grid-column: span 1 !important;
            }
            
            div[style*="grid-template-columns: repeat(auto-fit, minmax(450px, 1fr))"] {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
}
